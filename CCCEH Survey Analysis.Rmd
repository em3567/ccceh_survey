---
title: "CCCEH Survey Analysis"
author: "Eleanor Medley and Kendall Kruchten"
date: "7/16/2021"
output: html_document
editor_options: 
  chunk_output_type: inline
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r packages}
library(readr)
library(tidyverse)
library(dplyr)
library(tidyr) #For splitting comma
library(labelled)
library(naniar) #Allows us to replace all missing values with NA
library(data.table) #For splitting comma
```

## Import Data
```{r, import}
# import first data set
practice_data <- read.csv("Responses3.csv")
#view(practice_data)

# ESTABLISH CODEBOOK!

# get rid of first row of observations (the questions)
practice_data <- practice_data[-1,]
#view(practice_data)

# add a column that indicates the source
practice_data <- practice_data %>% mutate(data_source = "YMCA")
# glimpse(practice_data)

# import next data set (for now, I'll just re-import the same one)
practice_data2 <- read.csv("Responses3.csv")
#view(practice_data2)

# get rid of first row of observations (the questions)
practice_data2 <- practice_data2[-1,]
#view(practice_data2)

# add a column that indicates the source (different from the first data set)
practice_data2 <- practice_data2 %>% mutate(data_source = "Scouts")
# glimpse(practice_data2)

# Merge the data sets
all_practice_data <- rbind(practice_data, practice_data2)
#view(all_practice_data)

# NOTE: numbers on the far left are automatically assigned by R and are weird. Add an ID column with ID numbers assigned to respondents sequentially. 
all_practice_data <- all_practice_data %>% mutate(ID = 1:n()) %>% select(ID, everything())

```

###Change Missing to NA
```{r, missing}
missing_values <- c("")
all_practice_data <- all_practice_data %>%
  replace_with_na_if(.predicate = is.character,
                     condition = ~.x %in% (missing_values))
# view(all_practice_data)

#Below only worked for questions that return a number: 
#all_practice_data2 %>%
#  replace_with_na_all(condition = ~.x %in% missing_values)
#view(all_practice_data2)
```

##Split Answer Choice where comma occurs
```{r}
#These two methods don't really do what we want them to do. It will split into new rows the different races for parents and children. So for child 1, when you do this by child and parent race it creates 8 responses.
practice <- all_practice_data
practice2 <- practice %>% 
  mutate(practice = strsplit(as.character(Q6), ",")) %>%
  unnest(practice)
view(practice2)

practice3 <- separate_rows(all_practice_data, Q6, sep = ",", convert = TRUE)
practice3 <- separate_rows(all_practice_data, X1_Q14, sep = ",", convert = TRUE)
practice3 <- separate_rows(all_practice_data, X2_Q14, sep = ",", convert = TRUE)
practice3 <- separate_rows(all_practice_data, X3_Q14, sep = ",", convert = TRUE)
practice3 <- separate_rows(all_practice_data, X4_Q14, sep = ",", convert = TRUE)
practice3 <- separate_rows(all_practice_data, X5_Q14, sep = ",", convert = TRUE)
view(practice3)

# We'll have to figure out how we want to analyze mixed race families before we start doing this
```

##Child Age Demographics
```{r, age}
# Start by adding a new variable of child age groups:
# 0 - 3 (Infants)
# 4 - 6 (Preschool and Kindergarten)
# 7 - 9 (Early Elementary)
# 10 - 12 (Late Elementary/Early Middle School)

# Convert child ages to numbers
child_age <- c("X1_Q12", "X2_Q12", "X3_Q12", "X4_Q12", "X5_Q12")
all_practice_data[child_age] <- sapply(all_practice_data[child_age], as.numeric)
glimpse(all_practice_data)

# Add age category variable
all_practice_data <- all_practice_data %>% 
  mutate(X1_age_cat = if_else(X1_Q12 <= 3, "0-3", 
                            if_else(X1_Q12 <= 6, "4-6", 
                            if_else(X1_Q12 <= 9, "7-9",
                            if_else(X1_Q12 <= 12, "10-12", NA_character_)))))

all_practice_data <- all_practice_data %>% 
  mutate(X2_age_cat = if_else(X2_Q12 <= 3, "0-3", 
                            if_else(X2_Q12 <= 6, "4-6", 
                            if_else(X2_Q12 <= 9, "7-9",
                            if_else(X2_Q12 <= 12, "10-12", NA_character_)))))

all_practice_data <- all_practice_data %>% 
  mutate(X3_age_cat = if_else(X3_Q12 <= 3, "0-3", 
                            if_else(X3_Q12 <= 6, "4-6", 
                            if_else(X3_Q12 <= 9, "7-9",
                            if_else(X3_Q12 <= 12, "10-12", NA_character_)))))

all_practice_data <- all_practice_data %>% 
  mutate(X4_age_cat = if_else(X4_Q12 <= 3, "0-3", 
                            if_else(X4_Q12 <= 6, "4-6", 
                            if_else(X4_Q12 <= 9, "7-9",
                            if_else(X4_Q12 <= 12, "10-12", NA_character_)))))

all_practice_data <- all_practice_data %>% 
  mutate(X5_age_cat = if_else(X5_Q12 <= 3, "0-3", 
                            if_else(X5_Q12 <= 6, "4-6", 
                            if_else(X5_Q12 <= 9, "7-9",
                            if_else(X5_Q12 <= 12, "10-12", NA_character_)))))

# make subdataset Q12 with child ages and age groups
Q12 <- all_practice_data %>% select(ID, X1_Q12, X2_Q12, X3_Q12, X4_Q12, X5_Q12)
Q12 <- Q12 %>% pivot_longer(!ID, names_to = "child", values_to = "child_age")

Q12_2 <- all_practice_data %>% select(ID, X1_age_cat, X2_age_cat, X3_age_cat, X4_age_cat, X5_age_cat)
Q12_2 <- Q12_2 %>% pivot_longer(!ID, names_to = "child", values_to = "child_age_cat")

Q12 <- Q12_2 %>% select(child_age_cat) %>% cbind(Q12) %>% select(ID, child, child_age, child_age_cat)

# Proportions for each individual age
Q12 %>% drop_na() %>% count(child_age) %>% mutate(prop = n/sum(n))

#    Age     n   prop
#  <dbl> <int>  <dbl>
#1     0     2 0.0667
#2     1     6 0.2   
#3     2     2 0.0667
#4     5     4 0.133 
#5     6     4 0.133 
#6     8     2 0.0667
#7    10     2 0.0667
#8    11     2 0.0667
#9    12     6 0.2  

# Proportions for each age category 
Q12 %>% 
  drop_na() %>% 
  count(child_age_cat) %>% 
  mutate(prop = n/sum(n)) 

#  AgeCat   n    prop
#  <chr>  <int>  <dbl>
# 0-3       10	0.33333333		
# 10-12	    10	0.33333333		
# 4-6     	8	  0.26666667		
# 7-9	      2	  0.06666667	
```

## Child Gender Demographics
```{r, gender}
# Q13 What gender identity best describes Child X?

Q13 <- all_practice_data %>% select(ID, X1_Q13, X2_Q13, X3_Q13, X4_Q13, X5_Q13)
#view(Q13)
Q13 <- Q13 %>% pivot_longer(!ID, names_to = "child", values_to = "child_gender")
#view(Q13)

Q13 %>% drop_na() %>%
  count(child_gender) %>%
  mutate(prop = n/sum(n))

#Results
#gender n   prop
#Female	18	0.6		
#Male	  12	0.4	
```

<<<<<<< HEAD
##Child Race Demographics
```{r}
# Q14 What race/ethnicity category best describes Child X? (If your child is two or more races/ethnicities, please select all that apply)
# Thinking about above when we want to analyze do we want to have their race reflect multi and bi-racial? I think it is important it just may give us a lot of results and lessen the strength of our analysis 

Q14 <- all_practice_data %>% select(ID, X1_Q14, X2_Q14, X3_Q14, X4_Q14, X5_Q14)
#view(Q13)
Q14 <- Q14 %>% pivot_longer(!ID, names_to = "child", values_to = "child_race_eth")
#view(Q13)

Q14 %>% drop_na() %>%
  count(child_race_eth) %>%
  mutate(prop = n/sum(n))

#Results
#race_eth                         n   prop
#American Indian or Alaska Native 2	  0.06666667		
#Black or African American	      6	  0.20000000		
#Black or African American,White	16	0.53333333		
#East Asian	                      6	  0.20000000	
```

## Direct Motivation: Play vs. Beautification Rating 
```{r, rating}
# For each child 12 and under, rate on a scale of 1-10 how much they wear children's makeup and body products as play versus for beautification?

# First, need to convert ratings from chr to number
ratings <- c("X1_Q31_1", "X2_Q31_1", "X3_Q31_1", "X4_Q31_1", "X5_Q31_1")
all_practice_data[ratings] <- sapply(all_practice_data[ratings], as.numeric)
glimpse(all_practice_data)

# Create a sub dataset that is just the rating questions
Q31 <- all_practice_data %>% select(ID, X1_Q31_1, X2_Q31_1, X3_Q31_1, X4_Q31_1, X5_Q31_1)
Q31 <- Q31 %>% pivot_longer(!ID, names_to = "child", values_to = "rating")
view(Q31)
Q31 %>% filter(!is.na(rating)) %>% summarise(mean = mean(rating))
summary(Q31$rating)
# Summary above gives you overall mean 

# Mean rating by child age group
Q31_demo <- Q12 %>% select(child_age_cat) %>% cbind(Q31) %>% select(ID, child, rating, child_age_cat)
Q31_demo %>% drop_na() %>%
  group_by(fct_relevel(child_age_cat, "0-3", "4-6", "10-12")) %>%
  summarise(mean_rating = mean(rating))

#We will have to add 7-9 when we get results for that age group. 
#Results
#Age Cat  Score
#0-3	    9.333333
#4-6	    6.250000
#10-12	  2.200000

# Mean rating by child gender
Q31_demo <- Q13 %>% select(child_gender) %>% cbind(Q31_demo) %>% select(ID, child, rating, child_age_cat, child_gender)
Q31_demo %>% drop_na() %>%
  group_by(child_gender) %>%
  summarise(mean_rating = mean(rating))

#Results
#gender #mean_rating
#Female	6.5			
#Male	  3.0	

# Mean rating by child race/ethnicity
Q31_demo <- Q14 %>% select(child_race_eth) %>% cbind(Q31_demo) %>% select(ID, child, rating, child_age_cat, child_gender, child_race_eth)
Q31_demo %>% drop_na() %>%
  group_by(child_race_eth) %>%
  summarise(mean_rating = mean(rating))

#Results
#child_race_eth                   mean_rating
#American Indian or Alaska Native	8.000000		
#Black or African American,White	4.625000		
#East Asian	                      6.333333	

```

## Indirect Motivation: Duration of use
```{r, duration}
# Q26 In the last year, approximately how long does this child wear children's makeup and body products for when they use them? 
# 0-2 hours, 2-4 hours, 4-6 hours, 6-8 hours, 8+ hours, Do not know

# Combine data from all children into 1 table and assess distribution overall
Q26 <- all_practice_data %>% select(ID, X1_Q26, X2_Q26, X3_Q26, X4_Q26, X5_Q26)
Q26 <- Q26 %>% pivot_longer(!ID, names_to = "child", values_to = "duration")
#view(Q26)

Q26 %>% filter(!is.na(duration)) %>% count(duration) %>% mutate(prop = n/sum(n))

# Results
#duration   n   prop
#0-2 hours  8	  0.33333333		
#2-4 hours	14  0.58333333		
#8+ hours	  2	  0.08333333	

# Duration of use by child age category 
Q26_demo <- Q12 %>% select(child_age_cat) %>% cbind(Q26) %>% select(ID, child, duration, child_age_cat)
# view(Q26_Q12)

Q26_demo %>%
  drop_na() %>%
  group_by(child_age_cat) %>%
  count(duration) %>%
  mutate(prop = n/sum(n))

# Results 
# Age   Duration    n prop
# 0-3	  0-2 hours	  4	0.6666667	
# 0-3	  8+ hours	  2	0.3333333	
# 10-12	0-2 hours	  2	0.2000000	
# 10-12	2-4 hours	  8	0.8000000	
# 4-6	  0-2 hours	  2	0.2500000	
# 4-6	  2-4 hours	  6	0.7500000

# Duration of use by child gender
Q26_demo <- Q13 %>% select(child_gender) %>% cbind(Q26_demo) %>% select(ID, child, duration, child_age_cat, child_gender)
#view(Q26_Q13)

Q26_demo %>%
  drop_na() %>%
  group_by(child_gender) %>%
  count(duration) %>%
  mutate(prop = n/sum(n))

#Results
#Gender Duration  n   prop
#Female	0-2 hours	4	  0.250	
#Female	2-4 hours	10	0.625	
#Female	8+ hours	2	  0.125	
#Male	0-2 hours	  4	  0.500	
#Male	2-4 hours	  4	  0.500	

# Duration of use by child race/ethnicity
Q26_demo <- Q14 %>% select(child_race_eth) %>% cbind(Q26_demo) %>% select(ID, child, duration, child_age_cat, child_gender, child_race_eth)
#view(Q26_Q14)

Q26_demo %>% 
  drop_na() %>% 
  group_by(child_race_eth) %>%
  count(duration) %>%
  mutate(prop = n/sum(n))

#Results
#race_eth                         duration  n   prop
#American Indian or Alaska Native	0-2 hours	2	  1.0000000	
#Black or African American,White	0-2 hours	4	  0.2500000	
#Black or African American,White	2-4 hours	12	0.7500000	
#East Asian	                      0-2 hours	2 	0.3333333	
#East Asian	                      2-4 hours	2	  0.3333333	
#East Asian	                      8+ hours	2	  0.3333333	

#Duration of wear by child race 
Q14_3 <- Q14 %>% select(race_eth)
Q26_Q14 <- cbind(Q26, Q14_3)
#view(Q26_Q14)

Q26_Q14 %>%
  drop_na() %>%
  group_by(race_eth) %>%
  count(duration) %>%
  mutate(prop = n/sum(n))

#Results
#Race                             Duration  n  %
#American Indian or Alaska Native	0-2 hours	2	 1.0000000
#Black or African American,White	  0-2 hours	4	 0.2500000
#Black or African American,White	  2-4 hours	12 0.7500000
#East Asian	                      0-2 hours	2	 0.3333333
#East Asian	                      2-4 hours	2	 0.3333333
#East Asian	                      8+ hours	2	 0.3333333
```

### All Children
```{r}
#Q39 How often do you read the ingredients list before purchasing children's makeup and body products?

all_practice_data %>%
  filter(!is.na(Q39)) %>%
  count(Q39) %>%
  mutate(prop = n/sum(n))
#     Q39 n prop
#1  Never 4  0.5
#2 Rarely 4  0.5

#Q40 Approximately how frequently do you buy children's makeup and body products for your children 12 and under? 

all_practice_data %>%
  filter(!is.na(Q40)) %>%
  count(Q40) %>%
  mutate(prop = n/sum(n))
#             Q40 n prop
#1 Every 6 months 4  0.5
#2    Once a year 4  0.5
```
