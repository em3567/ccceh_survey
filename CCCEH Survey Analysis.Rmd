---
title: "CCCEH Survey Analysis"
author: "Eleanor Medley and Kendall Kruchten"
date: "7/16/2021"
output: html_document
editor_options: 
  chunk_output_type: inline
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r packages}
library(readr)
library(tidyverse)
library(dplyr)
library(labelled)
library(naniar) #Allows us to replace all missing values with NA
```

## Import Data
```{r, import}
# import first data set
practice_data <- read.csv("Responses3.csv")
#view(practice_data)

# ESTABLISH CODEBOOK!

# get rid of first row of observations (the questions)
practice_data <- practice_data[-1,]
#view(practice_data)

# add a column that indicates the source
practice_data <- practice_data %>% mutate(data_source = "YMCA")
# glimpse(practice_data)

# import next data set (for now, I'll just re-import the same one)
practice_data2 <- read.csv("Responses3.csv")
#view(practice_data2)

# get rid of first row of observations (the questions)
practice_data2 <- practice_data2[-1,]
#view(practice_data2)

# add a column that indicates the source (different from the first data set)
practice_data2 <- practice_data2 %>% mutate(data_source = "Scouts")
# glimpse(practice_data2)

# Merge the data sets
all_practice_data <- rbind(practice_data, practice_data2)
#view(all_practice_data)

# NOTE: numbers on the far left are automatically assigned by R and are weird. Add an ID column with ID numbers assigned to respondents sequentially. 
all_practice_data <- all_practice_data %>% mutate(ID = 1:n()) %>% select(ID, everything())

```

###Change Missing to NA
```{r, missing}
missing_values <- c("")
all_practice_data <- all_practice_data %>%
  replace_with_na_if(.predicate = is.character,
                     condition = ~.x %in% (missing_values))
# view(all_practice_data)

#Below only worked for questions that return a number: 
#all_practice_data2 %>%
#  replace_with_na_all(condition = ~.x %in% missing_values)
#view(all_practice_data2)
```


##Child Age Demographics
```{r, age}
# Start by adding a new variable of child age groups:
# 0 - 3 (Infants)
# 4 - 6 (Preschool and Kindergarten)
# 7 - 9 (Early Elementary)
# 10 - 12 (Late Elementary/Early Middle School)

# Convert child ages to numbers
child_age <- c("X1_Q12", "X2_Q12", "X3_Q12", "X4_Q12", "X5_Q12")
all_practice_data[child_age] <- sapply(all_practice_data[child_age], as.numeric)
glimpse(all_practice_data)

# Add age category variable
all_practice_data <- all_practice_data %>% 
  mutate(child1_age_cat = if_else(X1_Q12 <= 3, "0-3", 
                            if_else(X1_Q12 <= 6, "4-6", 
                            if_else(X1_Q12 <= 9, "7-9",
                            if_else(X1_Q12 <= 12, "10-12", NA_character_)))))

all_practice_data <- all_practice_data %>% 
  mutate(child2_age_cat = if_else(X2_Q12 <= 3, "0-3", 
                            if_else(X2_Q12 <= 6, "4-6", 
                            if_else(X2_Q12 <= 9, "7-9",
                            if_else(X2_Q12 <= 12, "10-12", NA_character_)))))

all_practice_data <- all_practice_data %>% 
  mutate(child3_age_cat = if_else(X3_Q12 <= 3, "0-3", 
                            if_else(X3_Q12 <= 6, "4-6", 
                            if_else(X3_Q12 <= 9, "7-9",
                            if_else(X3_Q12 <= 12, "10-12", NA_character_)))))

all_practice_data <- all_practice_data %>% 
  mutate(child4_age_cat = if_else(X4_Q12 <= 3, "0-3", 
                            if_else(X4_Q12 <= 6, "4-6", 
                            if_else(X4_Q12 <= 9, "7-9",
                            if_else(X4_Q12 <= 12, "10-12", NA_character_)))))

all_practice_data <- all_practice_data %>% 
  mutate(child5_age_cat = if_else(X5_Q12 <= 3, "0-3", 
                            if_else(X5_Q12 <= 6, "4-6", 
                            if_else(X5_Q12 <= 9, "7-9",
                            if_else(X5_Q12 <= 12, "10-12", NA_character_)))))

#Proportions for each individual age
Q12 <- all_practice_data %>% select(ID, X1_Q12, X2_Q12, X3_Q12, X4_Q12, X5_Q12)
Q12 <- Q12 %>% pivot_longer(!ID, names_to = "child", values_to = "age")
Q12 %>% count(age)
Q12 %>% filter(!is.na(age)) %>% count(age) %>% mutate(prop = n/sum(n))
#    Age     n   prop
#  <dbl> <int>  <dbl>
#1     0     2 0.0667
#2     1     6 0.2   
#3     2     2 0.0667
#4     5     4 0.133 
#5     6     4 0.133 
#6     8     2 0.0667
#7    10     2 0.0667
#8    11     2 0.0667
#9    12     6 0.2  

# Proportions for each age category 
Q12_2 <- all_practice_data %>% select(ID, child1_age_cat, child2_age_cat, child3_age_cat, child4_age_cat, child5_age_cat)
Q12_2 <- Q12_2 %>% pivot_longer(!ID, names_to = "child", values_to = "age_cat")

Q12_2 %>% count(age_cat)
Q12_2 %>% filter(!is.na(age_cat)) %>% count(age_cat) %>% mutate(prop = n/sum(n))
#  AgeCat     n   prop
#  <chr>  <int>  <dbl>
#1 0-3       10 0.333 
#2 4-6        8 0.267 
#3 7-9        2 0.0667 
#4 10-12     10 0.333
```

## Child Gender Demographics
```{r, gender}
# Q13 What gender identity best describes Child X?

Q13 <- all_practice_data %>% select(ID, X1_Q13, X2_Q13, X3_Q13, X4_Q13, X5_Q13)
#view(Q13)
Q13 <- Q13 %>% pivot_longer(!ID, names_to = "child", values_to = "gender")
#view(Q13)

Q13 %>% drop_na() %>%
  count(gender) %>%
  mutate(prop = n/sum(n))

#Results
#gender n   prop
#Female	18	0.6		
#Male	  12	0.4	

```


## Direct Motivation: Play vs. Beautification Rating 
```{r, rating}
# For each child 12 and under, rate on a scale of 1-10 how much they wear children's makeup and body products as play versus for beautification?

# First, need to convert ratings from chr to number
ratings <- c("X1_Q31_1", "X2_Q31_1", "X3_Q31_1", "X4_Q31_1", "X5_Q31_1")
all_practice_data[ratings] <- sapply(all_practice_data[ratings], as.numeric)
glimpse(all_practice_data)

# Create a sub dataset that is just the rating questions
Q31 <- all_practice_data %>% select(ID, X1_Q31_1, X2_Q31_1, X3_Q31_1, X4_Q31_1, X5_Q31_1)
Q31 <- Q31 %>% pivot_longer(!ID, names_to = "child", values_to = "rating")
view(Q31)
Q31 %>% filter(!is.na(rating)) %>% summarise(mean = mean(rating))
summary(Q31$rating)
# Summary above gives you overall mean 

#Data rating by child age category 
Q12_3 <- Q12_2 %>% select(age_cat)
Q31_2 <- Q31 %>% select(rating)
Q31_Q12 <- cbind(Q12_3, Q31_2)
view(Q31_Q12)
Q31_Q12 %>%
  filter(!is.na(age_cat)) %>%
  filter(!is.na(rating)) %>%
  group_by(rating) %>%
  count(age_cat) %>%
  mutate(prop = n/sum(n))
#Results
#Score Age    n %
#1	   10-12	4	1.0000000	
#2	   10-12	4	1.0000000	
#5	   10-12	2	0.3333333	
#5	   4-6	  4	0.6666667	
#7	   4-6	  2	1.0000000	
#8	   0-3	  2	0.5000000	
#8	   4-6	  2	0.5000000	
#10	   0-3	  4	1.0000000	

# Mean rating by Age Category 
Q31_Q12 %>% drop_na() %>%
  group_by(fct_relevel(age_cat, "0-3", "4-6", "10-12")) %>%
  summarise(mean_rating = mean(rating))

```

## Indirect Motivation: Duration of wear
```{r, duration}
# Q26 In the last year, approximately how long does this child wear children's makeup and body products for when they use them? 
# 0-2 hours, 2-4 hours, 4-6 hours, 6-8 hours, 8+ hours, Do not know

# Combine data from all children into 1 table and assess distribution overall
Q26 <- all_practice_data %>% select(ID, X1_Q26, X2_Q26, X3_Q26, X4_Q26, X5_Q26)
Q26 <- Q26 %>% pivot_longer(!ID, names_to = "child", values_to = "duration")

Q26 %>% count(duration)
Q26 %>% filter(!is.na(duration)) %>% count(duration) %>% mutate(prop = n/sum(n))
view(Q26)

# Duration of wear by child age category 
# Use Q12_3
Q26_3 <- Q26 %>% select(duration)
Q26_Q12 <- cbind(Q12_3, Q26_3)
view(Q26_Q12)

Q26_Q12 %>%
  drop_na() %>%
  group_by(age_cat) %>%
  count(duration) %>%
  mutate(prop = n/sum(n))

# Results 
# Age Duration    n prop
# 0-3	0-2 hours	  4	0.6666667	
# 0-3	8+ hours	  2	0.3333333	
# 10-12	0-2 hours	2	0.2000000	
# 10-12	2-4 hours	8	0.8000000	
# 4-6	0-2 hours	  2	0.2500000	
# 4-6	2-4 hours	  6	0.7500000

# Duration of wear by child gender
Q13_3 <- Q13 %>% select(gender)
Q26_Q13 <- cbind(Q26, Q13_3)
#view(Q26_Q13)

Q26_Q13 %>%
  drop_na() %>%
  group_by(gender) %>%
  count(duration) %>%
  mutate(prop = n/sum(n))

#Results
#Female	0-2 hours	4	0.250	
#Female	2-4 hours	10	0.625	
#Female	8+ hours	2	0.125	
#Male	0-2 hours	4	0.500	
#Male	2-4 hours	4	0.500	

```

### All Children
```{r}
#Q39 How often do you read the ingredients list before purchasing children's makeup and body products?

all_practice_data %>%
  filter(!is.na(Q39)) %>%
  count(Q39) %>%
  mutate(prop = n/sum(n))
#     Q39 n prop
#1  Never 4  0.5
#2 Rarely 4  0.5

#Q40 Approximately how frequently do you buy children's makeup and body products for your children 12 and under? 

all_practice_data %>%
  filter(!is.na(Q40)) %>%
  count(Q40) %>%
  mutate(prop = n/sum(n))
#             Q40 n prop
#1 Every 6 months 4  0.5
#2    Once a year 4  0.5
```
